<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Eiffel-remrem-generate : eiffel-remrem-generate">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Eiffel-remrem-generate</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/Ericsson/eiffel-remrem-generate">View on GitHub</a>

          <h1 id="project_title">Eiffel-remrem-generate</h1>
          <h2 id="project_tagline">eiffel-remrem-generate</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/Ericsson/eiffel-remrem-generate/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/Ericsson/eiffel-remrem-generate/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p>REMReM (REST Mailbox for Registered Messages) is a set of tools that can be used to generate validated Eiffel messages and publish them on a RabbitMQ message bus. They can be run as micro services or as stand-alone CLI versions. For more details on the micro services and the REMReM design, see <a href="https://github.com/Ericsson/eiffel-remrem">https://github.com/Ericsson/eiffel-remrem</a> </p>

<p>Generate takes a partial message in JSON format, validates it and adds mandatory fields before outputting a complete, valid Eiffel message.</p>
<h2>
<a id="compatibility" class="anchor" href="#compatibility" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Compatibility</h2>

<ul>
<li>JDK 8</li>
<li>Tomcat 8</li>
</ul>

<h2>
<a id="the-releases" class="anchor" href="#the-releases" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The releases</h2>

<p>Binary is relased via <a href="https://jitpack.io/#Ericsson/eiffel-remrem-generate">jitPack</a>.</p>
<p><b>Download the latest version of CLI from </b><a onClick="getLatestVersion('cli','jar');">generate-cli.jar</a></p>
<p><b>Download the latest version of Service from </b><a onClick="getLatestVersion('service','war');">generate-service.war</a></p>
<div id="downloadLink" style="visibility: hidden;color: red;font-size: 14px;">
</div>
<script type="text/javascript">
function getLatestVersion(type,extn){
	var xhr = new XMLHttpRequest(); 
	xhr.open("GET", "https://jitpack.io/v/Ericsson/eiffel-remrem-generate.svg"); 
 	xhr.responseType = "blob";//force the HTTP response, response-type header to be blob
 	xhr.onload = function() 
 	{
 		var blob = xhr.response;
 		var reader = new FileReader();
 		reader.addEventListener("loadend", function() {
			var result = reader.result;
			if(result=="Repo not found or no access token provided"){
				document.getElementById("downloadLink").innerHTML = result;
				document.getElementById("downloadLink").style.visibility = "";
			}
			else{
				document.getElementById("downloadLink").innerHTML = result;
				var val = document.getElementsByTagName("text")[2].innerHTML;
				val = val.trim();
				urlLink = "https://jitpack.io/com/github/Ericsson/eiffel-remrem-generate/generate-"+type +"\/"+val+"/generate-"+type +"-"+val+"."+extn;
				var link = document.createElement("a");
				link.href = urlLink;
				link.click();
			}
	 	});
 		reader.readAsBinaryString(blob);
 	}
 	xhr.send();
}
</script>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation (Micro service)</h2>

<p>Start the self executing JAR</p>
<pre>java -jar generate-cli.jar</pre>

<p>or deploy it in Tomcat.</p>

<h2>
<a id="usage-cli-command-line-interface" class="anchor" href="#usage-cli-command-line-interface" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage CLI (Command Line Interface).</h2>

<p>Examples used here are for the next generation of Eiffel events called semantics which is open source. Please follow <a href="https://github.com/Ericsson/eiffel/tree/master/eiffel-syntax-and-usage">eiffel syntax</a> and <a href="https://github.com/Ericsson/eiffel/tree/master/eiffel-vocabulary">eiffel vocabulary</a></p>

<pre>java -jar generate-cli.jar -h
You passed help flag.
usage: java -jar
 -d,--debug                  enable debug traces
 -f,--content_file           message content file
 -h,--help                   show help.
 -json,--json_content        json content
 -mp,--messaging_protocol    name of messaging protocol to be used,
                             e.g. eiffel3, semantics
 -r,--response_file          file to store the response in, optional
 -t,--message_type           message type, mandatory if -f or -json
                             is given
 -v,--list_versions          lists the versions of generate and all loaded protocols
</pre>

<strong><p>Generate Templates for eiffel-remrem-semantics to be used are available <a href="http://ericsson.github.io/eiffel-remrem-semantics/">here.</a></p></strong>


<p>The message must exist in a json file, for example <strong><em>eiffelactivityfinished.json</em></strong> might contain the following message:<br></p>
<pre>
{
  "msgParams": {
    "meta": {
    "type": "EiffelActivityFinishedEvent",
      "tags": [
        "tag1",
        "tag2"
      ],
      "source": {
        "domainId": "example.domain",
        "host": "host",
        "name": "name",
        "uri": "http:\/\/java.sun.com\/j2se\/1.3\/",
        "gav": {
          "groupId": "com.github.Ericsson",
          "artifactId": "eiffel-remrem-semantics",
          "version": "0.2.9"
        }
      },
      "security": {
        "sdm": {
          "authorIdentity": "test",
          "encryptedDigest": "sample"
        }
      }
    }
  },
  "eventParams": {
    "data": {
      "outcome": {
        "conclusion": "SUCCESSFUL"
      },
      "persistentLogs": [{
          "name": "firstLog",
          "uri": "http:\/\/myHost.com\/firstLog"
        },
        {
          "name": "otherLog",
          "uri": "isbn:0-486-27557-4"
        }
      ]
    },
    "links": [
        {
            "type": "ACTIVITY_EXECUTION",
            "target": "aaaaaaaa-bbbb-5ccc-8ddd-eeeeeeeeeee1"
        }
    ]
  }
}</pre>

<h3>
<a id="with-input-from-the-example-file-shown-above-and-output-to-a-file" class="anchor" href="#with-input-from-the-example-file-shown-above-and-output-to-a-file" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>With input from the example file shown above and output to a file:</h3>

<pre><code> $ java -jar generate-cli.jar -f eiffelactivityfinished.json -t eiffelactivityfinishedevent -r output.json
</code></pre>

<p>Gives:</p>

<pre>$cat output.json
[
   {
      "meta": {
         "id": "7214aead-7702-44dd-915d-a8c0cd346eac",
         "type": "EiffelActivityFinishedEvent",
         "version": "1.0.0",
         "time": 1508760894525,
         "tags": [
            "tag1",
            "tag2"
         ],
         "source": {
            "domainId": "example.domain",
            "host": "host",
            "name": "name",
            "gav": {
               "groupId": "com.github.Ericsson",
               "artifactId": "eiffel-remrem-semantics",
               "version": "0.2.9"
            },
            "uri": "http://java.sun.com/j2se/1.3/"
         },
         "security": {
            "sdm": {
               "authorIdentity": "test",
               "encryptedDigest": "sample"
            }
         }
      },
      "data": {
         "outcome": {
            "conclusion": "SUCCESSFUL"
         },
         "persistentLogs": [
            {
               "name": "firstLog",
               "uri": "http://myHost.com/firstLog"
            },
            {
               "name": "otherLog",
               "uri": "isbn:0-486-27557-4"
            }
         ],
         "customData": []
      },
      "links": [
         {
            "type": "ACTIVITY_EXECUTION",
            "target": "aaaaaaaa-bbbb-5ccc-8ddd-eeeeeeeeeee1"
         }
      ]
   }
]</pre>

<h3>
<a id="same-example-but-output-the-result-on-the-console" class="anchor" href="#same-example-but-output-the-result-on-the-console" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Same example but output the result on the console:</h3>

<pre><code> $ java -jar generate-cli.jar -f eiffelactivityfinished.json -t eiffelactivityfinished
</code></pre>

<p>Gives:</p>

<pre>[{"meta":{"id":"963da060-f2cf-4370-a68d-67fd872def36","type":"EiffelActivityFinishedEvent","version":"1.0.0","time":1513758440588,"tags":["tag1","tag2"],"source":{"domainId":"example.domain","host":"host","name":"name","serializer":{"groupId":"com.github.Ericsson","artifactId":"eiffel-remrem-semantics","version":"0.3.1"},"uri":"http://java.sun.com/j2se/1.3/"},"security":{"sdm":{"authorIdentity":"test","encryptedDigest":"sample"}}},"data":{"outcome":{"conclusion":"SUCCESSFUL"},"persistentLogs":[{"name":"firstLog","uri":"http://myHost.com/firstLog"},{"name":"otherLog","uri":"isbn:0-486-27557-4"}],"customData":[]},"links":[{"type":"ACTIVITY_EXECUTION","target":"aaaaaaaa-bbbb-5ccc-8ddd-eeeeeeeeeee1"}]}]</pre>

<h3>
<a id="same-example-but-this-time-the-data-is-supplied-as-a-command-line-argument" class="anchor" href="#same-example-but-this-time-the-data-is-supplied-as-a-command-line-argument" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Same example, but this time the data is supplied as a command line argument:</h3>

<pre><code>$ java -jar generate-cli.jar -t eiffelactivityfinished -json '{"msgParams": {"meta": {"type":"EiffelActivityFinishedEvent","tags": ["tag1", "tag2"],"source": {"domainId": "example.domain","host": "host","name": "name","uri": "http://java.sun.com/j2se/1.3/","gav": {"groupId": "com.github.Ericsson","artifactId": "eiffel-remrem-semantics",       "version": "0.2.9"}}}},"eventParams": {"data": {"outcome": {"conclusion": "SUCCESSFUL"},"persistentLogs": [{"name": "firstLog","uri": "http://myHost.com/firstLog"},{"name": "otherLog","uri": "isbn:0-486-27557-4"}]},"links": [{"type": "ACTIVITY_EXECUTION","target": "aaaaaaaa-bbbb-5ccc-8ddd-eeeeeeeeeee1"}]}}'
</code></pre>

<p>Gives:</p>

<pre>[{"meta":{"id":"963da060-f2cf-4370-a68d-67fd872def36","type":"EiffelActivityFinishedEvent","version":"1.0.0","time":1513758440588,"tags":["tag1","tag2"],"source":{"domainId":"example.domain","host":"host","name":"name","serializer":{"groupId":"com.github.Ericsson","artifactId":"eiffel-remrem-semantics","version":"0.3.1"},"uri":"http://java.sun.com/j2se/1.3/"},"security":{"sdm":{"authorIdentity":"test","encryptedDigest":"sample"}}},"data":{"outcome":{"conclusion":"SUCCESSFUL"},"persistentLogs":[{"name":"firstLog","uri":"http://myHost.com/firstLog"},{"name":"otherLog","uri":"isbn:0-486-27557-4"}],"customData":[]},"links":[{"type":"ACTIVITY_EXECUTION","target":"aaaaaaaa-bbbb-5ccc-8ddd-eeeeeeeeeee1"}]}]</pre>

<p><strong>For loading protocol jars other than eiffel-remrem-semantics :</strong></p>
<pre><code> $ java -Djava.ext.dirs="/path/to/jars/" -jar generate-cli.jar -f eiffeljobfinished.json -t eiffeljobfinished -mp protocoltype
</code></pre>
<strong>Note: In the above example, protocol jar file must be present inside "/path/to/jars/" folder</strong>
<h2>
<a id="usage-rest-service" class="anchor" href="#usage-rest-service" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage REST service.</h2>

<p> Deploy the generate-service.war in tomcat</p>

<p>Examples used here are for the next generation of Eiffel events called semantics which is open source. Please follow <a href="https://github.com/Ericsson/eiffel/tree/master/eiffel-syntax-and-usage">eiffel syntax</a> and <a href="https://github.com/Ericsson/eiffel/tree/master/eiffel-vocabulary">eiffel vocabulary</a></p>

<p>Available REST resources for generate are:</p>

<p><table width="100%">
<tr><th>Resource</th><th>Method</th><th>Parameters</th><th>Request body</th></tr>
<tr><td>/eiffelsemantics</td><td>POST</td><td>msgType</td><td style="margin:0px;"><pre>
{
  "msgParams": {
    "meta": {
      # Matches the meta object
    }
  },
  "eventParams": {
    "data": {
      # Matches the data object
    },
    "links": {
      # Matches the links object
    }
  }
}
</pre></td></tr></table>

<h3>Versions Endpoint:</h3>
"/versions" endpoint is used to get the versions of messaging protocols along with the current version of generate in a json format.<br>

Ex:  http://localhost:8080/generate-service/versions/ <br>

Result:

<pre>
        {
            "serviceVersion": {
                "version": "0.8.1"
            },
            "endpointVersions": {
                "semanticsVersion": "0.2.5",
            }
        }
</pre>

<h3>Ldap configurations:</h3>
<p align="justify">Active Directory authentication can be enabled for the REMReM REST service by setting the configuration property <code>activedirectory.enabled=true</code>.</p>
<p>To authenticate with active ldap server we have to provide the following configurations in the <strong>tomcat/conf/config.properties </strong>file.</P>
<pre>
  activedirectory.ldapUrl         : &lt;LDAP server url&gt;
  activedirectory.managerPassword : &lt;LDAP server manager password(must be base64 Encrypted format)&gt;
  activedirectory.managerDn       : &lt;LDAP managerDn pattern&gt;
  activedirectory.rootDn          : &lt;LDAP rootDn pattern&gt;
  activedirectory.userSearchFilter: &lt;LDAP userSearchFilter pattern&gt;
</pre>

<p><strong> LDAP authentication without Base64 encryption: </strong></p>

<pre><code>$ curl -XPOST -H "Content-Type: application/json" --user username:password --data @ActivityCanceled.json http://localhost:8080/generate-service/eiffelsemantics?msgType=eiffelactivitycanceled</code></pre>

<p align="justify">Each HTTP request must then include an Authorization header with value <code>Basic &lt;Base64 encoded username:password&gt;</code>.</p>

<p><strong> LDAP authentication with Base64 encryption: </strong></p>

<pre><code>$ curl -XPOST -H "Content-Type: application/json" -H 'Authorization: Basic cGFzc3dvcmQ=' --data @ActivityCanceled.json http://localhost:8080/generate-service/eiffelsemantics?msgType=eiffelactivitycanceled</code></pre>


<h2>
<a id="testing" class="anchor" href="#testing" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Testing</h2>

<h3>
<a id="example-with-event-body-passed-to-service" class="anchor" href="#example-with-event-body-passed-to-service" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example with event body passed to service:<br>
</h3>

<pre>curl -H "Content-Type: application/json" -X POST -d '{"msgParams": {"meta": {"type": "EiffelActivityFinishedEvent", "tags": ["tag1","tag2"], "source": {"domainId": "example.domain", "host": "host", "name": "name", "uri": "http:\/\/java.sun.com\/j2se\/1.3\/", "gav": {"groupId": "com.github.Ericsson", "artifactId": "eiffel-remrem-semantics", "version": "0.2.9"}}, "security": {"sdm": {"authorIdentity": "test", "encryptedDigest": "sample"}}}}, "eventParams": {"data": {"outcome": {"conclusion": "SUCCESSFUL"}, "persistentLogs": [{"name": "firstLog", "uri": "http:\/\/myHost.com\/firstLog"}, {"name": "otherLog", "uri": "isbn:0-486-27557-4"}]}, "links": [{"type": "ACTIVITY_EXECUTION", "target": "aaaaaaaa-bbbb-5ccc-8ddd-eeeeeeeeeee1"}]}}' http://localhost:8080/generate-service/eiffelsemantics?msgType=eiffelactivityfinished</pre>

<p><strong>NOTE:</strong> For eiffel-remrem-semantics inputEventType is not mandatory it will be added based on event type query, But from the input.json the eventType should be camelcase</p>

<p><strong>NOTE:</strong> For other than eiffelsemantics protocol, provide the Java opts as: </p>
<pre>set JAVA_OPTS="-Djava.ext.dirs=/path/to/jars/" in catalina.sh</pre>
<strong>Note: In the above example, protocol jar file must be present inside "/path/to/jars/" folder</strong>
<h3>
<a id="example-with-event-body-in-a-file-body-singlejson-passed-to-service" class="anchor" href="#example-with-event-body-in-a-file-body-singlejson-passed-to-service" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example with event body in a file body-single.json passed to service:<br>
</h3>

<pre>curl -XPOST -H "Content-Type: application/json" --data @body-single.json http://localhost:8080/generate-service/eiffelsemantics?msgType=eiffelactivityfinished</pre>

<p><h2>Status Codes:</h2></p>
<p>HTTP Status Code is the Response Code for the HTTP Request.</p>
<table class="wikitable">
<tr>
<th style="text-align:left;"> Status code
</th>
<th style="text-align:left;"> Description
</th>
<th style="text-align:left;"> Comment
</th>

</tr>
<tr>
<td>200
</td>
<td>OK
</td>
<td> Event sent successfully
</td>
</tr>
<tr>
<td>400
</td>
<td> Bad Request
</td>
<td> Malformed JSON (Missing braces etc..), client need to fix problem in event before submitting again
</td>
</tr>
<tr>
<td>500
</td>
<td> Internal Server Error
</td>
<td> When REMReM generate is down, Possible to try again later when server is up
</td>

</tr>
<tr>
<td>503
</td>
<td> Service Unavailable
</td>
<td> When the message protocol is invalid
</td>

</tr></table>

      </section>

    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Eiffel-remrem-generate maintained by <a href="https://github.com/evasiba-ericsson">evasiba-ericsson</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

  </body>
</html>
